<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galerie Aviron</title>
  <style>
    body {
      font-family: 'Inter', Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background: #333;
      color: #fff;
      padding: 1rem 0;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    main { max-width: 1200px; margin: 20px auto; padding: 0 20px; }

    /* Filtres */
    .filters {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .filter-btn {
      display: inline-block;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 20px;
      border: 1px solid #ddd;
      background: #f8f8f8;
      text-decoration: none;
      color: #333;
      transition: 0.3s;
    }
    .filter-btn:hover { background: #007bff; color: #fff; border-color: #007bff; }

    /* Accordéon */
    details.accordion-item {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }
    summary {
      list-style: none;
      background: #007bff;
      color: #fff;
      padding: 15px 20px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 8px;
    }
    details[open] > summary { border-radius: 8px 8px 0 0; }
    summary .arrow { transition: transform 0.3s; }
    details[open] summary .arrow { transform: rotate(90deg); }

    .details-content { padding: 15px; }
    .group-header-aviron { font-size: 1.1em; color: #0056b3; margin: 10px 0; }

    /* Grille de photos */
    .photo-grid-aviron {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
    }
    .photo-item-aviron {
      cursor: pointer;
      border-radius: 4px;
      overflow: hidden;
      background: #fff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: 0.2s;
    }
    .photo-item-aviron:hover { transform: scale(1.05); }
    .photo-item-aviron img { width: 100%; height: 80px; object-fit: contain; }

    /* Modale / Carrousel */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      max-width: 1000px;
      width: 100%;
      position: relative;
      pointer-events: auto; /* s'assurer que les clics passent */

    }
      
    .close-button {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 28px;
  color: #333;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 20px;       /* zone cliquable plus grande */
  line-height: 1;
  border-radius: 50%;  /* optionnel : zone arrondie */
}

.close-button:hover {
  background: rgba(0,0,0,0.1); /* léger feedback visuel au survol */
}

    .close-button:focus { outline: none; }

    .carousel-container { position: relative; height: 80vh; overflow: hidden; }
    .carousel-track { display: flex; transition: transform 0.5s ease-in-out; height: 100%; }
    .carousel-item {
      min-width: 100%;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }
    .carousel-item img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 5px;
      font-size: 1.5em;
    }
      

    .carousel-nav.prev { left: 10px; }
    .carousel-nav.next { right: 10px; }
  </style>
</head>
<body>
  <header><h1>Événements Aviron du TUC</h1></header>
  <main>
    <section class="filters">
      <a href="index.html" class="filter-btn">Retour à la page principale</a>
    </section>
    <section class="events-gallery">
      <h2>Nos Événements en Images</h2>
      <div id="eventsContainer"><p style="text-align:center;">Chargement en cours...</p></div>
    </section>
  </main>

  <!-- Modale -->
  <div id="carouselModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="close-button" aria-label="Fermer la modale">&times;</button>
      <div class="carousel-container">
        <div class="carousel-track"></div>
        <button class="carousel-nav prev">❮</button>
        <button class="carousel-nav next">❯</button>
      </div>
    </div>
  </div>

  <footer><p style="text-align:center;">© 2025 Ma Galerie Photo</p></footer>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  const eventsContainer = document.getElementById('eventsContainer');
  const modal = document.getElementById('carouselModal');
  const closeButton = modal.querySelector('.close-button');
  const carouselTrack = modal.querySelector('.carousel-track');
  const prevBtn = modal.querySelector('.carousel-nav.prev');
  const nextBtn = modal.querySelector('.carousel-nav.next');

  let photos = [], currentIndex = 0;

  async function loadEvents() {
    try {
      const res = await fetch('generate_aviron_data.php');
      const data = await res.json();
      renderEvents(data);
    } catch (e) {
      eventsContainer.innerHTML = '<p style="color:red;text-align:center;">Erreur de chargement.</p>';
      console.error(e);
    }
  }

  function renderEvents(events) {
    eventsContainer.innerHTML = '';
    events.forEach(ev => {
      const details = document.createElement('details');
      details.classList.add('accordion-item');
      details.innerHTML = `
        <summary>
          <h3 style="margin:0;">${ev.eventName}</h3>
          <span class="arrow">▶</span>
        </summary>
        <div class="details-content">
          <p>${ev.eventDescription}</p>
          <div id="gallery-${ev.eventId}"></div>
        </div>
      `;
      eventsContainer.appendChild(details);

      details.addEventListener('toggle', () => {
        if (details.open) renderGallery(ev.eventId, ev.photos);
      });
    });
  }

  function renderGallery(id, photosList) {
    const container = document.getElementById(`gallery-${id}`);
    if (!container || container.childElementCount > 0) return;

    const grouped = photosList.reduce((acc, p) => {
      const g = p.groupId || 'autre';
      (acc[g] = acc[g] || []).push(p);
      return acc;
    }, {});

    for (const group in grouped) {
      const title = document.createElement('h4');
      title.classList.add('group-header-aviron');
      title.textContent = `Équipage du/de: ${group.toUpperCase()}`;
      container.appendChild(title);

      const grid = document.createElement('div');
      grid.classList.add('photo-grid-aviron');

      grouped[group].forEach(p => {
        const item = document.createElement('div');
        item.classList.add('photo-item-aviron');
        item.innerHTML = `<img src="${p.thumb}" alt="${p.description || ''}">`;
        item.addEventListener('click', () => openCarousel(grouped[group], p.id));
        grid.appendChild(item);
      });

      container.appendChild(grid);
    }
  }

  function openCarousel(groupPhotos, id) {
    photos = groupPhotos;
    currentIndex = photos.findIndex(p => p.id === id);
    renderCarouselItems();
    modal.style.display = 'flex';
    setTimeout(() => updateCarousel(), 10);
  }

  function renderCarouselItems() {
    carouselTrack.innerHTML = '';
    photos.forEach(p => {
      const item = document.createElement('div');
      item.classList.add('carousel-item');
      item.innerHTML = `<img src="${p.src}" alt="">`;
      carouselTrack.appendChild(item);
    });
  }

  function updateCarousel() {
    const width = carouselTrack.parentElement.offsetWidth;
    carouselTrack.style.transform = `translateX(-${currentIndex * width}px)`;
  }

  prevBtn.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + photos.length) % photos.length;
    updateCarousel();
  });

  nextBtn.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % photos.length;
    updateCarousel();
  });

  closeButton.addEventListener('click', (e) => {
    e.stopPropagation();
    modal.style.display = 'none';
  });

  modal.addEventListener('click', (e) => {
    if (e.target === modal) modal.style.display = 'none';
  });

  window.addEventListener('resize', () => {
    if (modal.style.display === 'flex') updateCarousel();
  });

  loadEvents();
});
  </script>
</body>
</html>
